var e,t;"function"==typeof(e=globalThis.define)&&(t=e,e=null),function(t,s,r,a,i){var n="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:"undefined"!=typeof window?window:"undefined"!=typeof global?global:{},o="function"==typeof n[a]&&n[a],l=o.cache||{},c="undefined"!=typeof module&&"function"==typeof module.require&&module.require.bind(module);function h(e,s){if(!l[e]){if(!t[e]){var r="function"==typeof n[a]&&n[a];if(!s&&r)return r(e,!0);if(o)return o(e,!0);if(c&&"string"==typeof e)return c(e);var i=Error("Cannot find module '"+e+"'");throw i.code="MODULE_NOT_FOUND",i}d.resolve=function(s){var r=t[e][1][s];return null!=r?r:s},d.cache={};var u=l[e]=new h.Module(e);t[e][0].call(u.exports,d,u,u.exports,this)}return l[e].exports;function d(e){var t=d.resolve(e);return!1===t?{}:h(t)}}h.isParcelRequire=!0,h.Module=function(e){this.id=e,this.bundle=h,this.exports={}},h.modules=t,h.cache=l,h.parent=o,h.register=function(e,s){t[e]=[function(e,t){t.exports=s},{}]},Object.defineProperty(h,"root",{get:function(){return n[a]}}),n[a]=h;for(var u=0;u<s.length;u++)h(s[u]);if(r){var d=h(r);"object"==typeof exports&&"undefined"!=typeof module?module.exports=d:"function"==typeof e&&e.amd?e(function(){return d}):i&&(this[i]=d)}}({kgW6q:[function(e,t,s){e("../../../src/background")},{"../../../src/background":"fx8Od"}],fx8Od:[function(e,t,s){var r=e("@plasmohq/storage");let a=new r.Storage;async function i(e,t,s){try{switch(e.type){case"GET_AUTH_STATE":{let e=await a.get("isAuthenticated"),t=await a.get("userId");s({isAuthenticated:e??!1,userId:t});break}case"SET_AUTH_STATE":await a.set("isAuthenticated",e.payload.isAuthenticated),e.payload.userId&&await a.set("userId",e.payload.userId),s({success:!0});break;case"GET_CREDITS":{let e=await a.get("credits");s({credits:e??1});break}case"SET_CREDITS":await a.set("credits",e.payload),s({success:!0});break;case"DECREMENT_CREDITS":{let e=await a.get("credits")??1,t=await a.get("isPremium");if(t)s({credits:-1});else if(e>0){let t=e-1;await a.set("credits",t),s({credits:t})}else s({credits:0,error:"No credits remaining"});break}case"SET_PREMIUM":await a.set("isPremium",e.payload),e.payload&&await a.set("credits",-1),s({success:!0});break;case"GET_USER_STATE":{let[e,t,r,i]=await Promise.all([a.get("isAuthenticated"),a.get("isPremium"),a.get("credits"),a.get("userId")]);s({isAuthenticated:e??!1,isPremium:t??!1,credits:t?-1:r??1,userId:i});break}case"OPTIMIZE_IMAGE":s({success:!0,aiImageUrl:e.payload.imageUrl});break;case"CREATE_CHECKOUT":s({url:"https://checkout.stripe.com/placeholder"});break;default:s({error:"Unknown message type"})}}catch(e){console.error("[Instagram AI Optimizer] Message handling error:",e),s({error:String(e)})}}chrome.runtime.onInstalled.addListener(async e=>{"install"===e.reason?(await a.set("credits",1),await a.set("isPremium",!1),await a.set("isAuthenticated",!1),console.log("[Instagram AI Optimizer] Extension installed, defaults set")):"update"===e.reason&&console.log("[Instagram AI Optimizer] Extension updated to version",chrome.runtime.getManifest().version)}),chrome.action.onClicked.addListener(e=>{e.url?.includes("instagram.com")&&chrome.tabs.sendMessage(e.id,{type:"TOGGLE_PANEL"})}),chrome.runtime.onMessage.addListener((e,t,s)=>(i(e,t,s),!0)),chrome.tabs.onUpdated.addListener((e,t,s)=>{"complete"===t.status&&s.url?.includes("instagram.com")&&chrome.tabs.sendMessage(e,{type:"PAGE_LOADED"}).catch(()=>{})})},{"@plasmohq/storage":"3wfAg"}],"3wfAg":[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"BaseStorage",()=>o),r.export(s,"Storage",()=>l);var a=e("pify"),i=r.interopDefault(a),n=()=>{try{let e=globalThis.navigator?.userAgent.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if("Chrome"===e[1])return 100>parseInt(e[2])||globalThis.chrome.runtime?.getManifest()?.manifest_version===2}catch{}return!1},o=class{#e;#t;get primaryClient(){return this.#t}#s;get secondaryClient(){return this.#s}#r;get area(){return this.#r}get hasWebApi(){try{return"u">typeof window&&!!window.localStorage}catch(e){return console.error(e),!1}}#a=new Map;#i;get copiedKeySet(){return this.#i}isCopied=e=>this.hasWebApi&&(this.allCopied||this.copiedKeySet.has(e));#n=!1;get allCopied(){return this.#n}getExtStorageApi=()=>globalThis.browser?.storage||globalThis.chrome?.storage;get hasExtensionApi(){try{return!!this.getExtStorageApi()}catch(e){return console.error(e),!1}}isWatchSupported=()=>this.hasExtensionApi;keyNamespace="";isValidKey=e=>e.startsWith(this.keyNamespace);getNamespacedKey=e=>`${this.keyNamespace}${e}`;getUnnamespacedKey=e=>e.slice(this.keyNamespace.length);serde={serializer:JSON.stringify,deserializer:JSON.parse};constructor({area:e="sync",allCopied:t=!1,copiedKeyList:s=[],serde:r={}}={}){this.setCopiedKeySet(s),this.#r=e,this.#n=t,this.serde={...this.serde,...r};try{this.hasWebApi&&(t||s.length>0)&&(this.#s=window.localStorage)}catch{}try{this.hasExtensionApi&&(this.#e=this.getExtStorageApi(),n()?this.#t=(0,i.default)(this.#e[this.area],{exclude:["getBytesInUse"],errorFirst:!1}):this.#t=this.#e[this.area])}catch{}}setCopiedKeySet(e){this.#i=new Set(e)}rawGetAll=()=>this.#t?.get();getAll=async()=>Object.entries(await this.rawGetAll()).filter(([e])=>this.isValidKey(e)).reduce((e,[t,s])=>(e[this.getUnnamespacedKey(t)]=s,e),{});copy=async e=>{let t=void 0===e;if(!t&&!this.copiedKeySet.has(e)||!this.allCopied||!this.hasExtensionApi)return!1;let s=this.allCopied?await this.rawGetAll():await this.#t.get((t?[...this.copiedKeySet]:[e]).map(this.getNamespacedKey));if(!s)return!1;let r=!1;for(let e in s){let t=s[e],a=this.#s?.getItem(e);this.#s?.setItem(e,t),r||=t!==a}return r};rawGet=async e=>(await this.rawGetMany([e]))[e];rawGetMany=async e=>this.hasExtensionApi?await this.#t.get(e):e.filter(this.isCopied).reduce((e,t)=>(e[t]=this.#s?.getItem(t),e),{});rawSet=async(e,t)=>await this.rawSetMany({[e]:t});rawSetMany=async e=>(this.#s&&Object.entries(e).filter(([e])=>this.isCopied(e)).forEach(([e,t])=>this.#s.setItem(e,t)),this.hasExtensionApi&&await this.#t.set(e),null);clear=async(e=!1)=>{e&&this.#s?.clear(),await this.#t.clear()};rawRemove=async e=>{await this.rawRemoveMany([e])};rawRemoveMany=async e=>{this.#s&&e.filter(this.isCopied).forEach(e=>this.#s.removeItem(e)),this.hasExtensionApi&&await this.#t.remove(e)};removeAll=async()=>{let e=Object.keys(await this.getAll());await this.removeMany(e)};watch=e=>{let t=this.isWatchSupported();return t&&this.#o(e),t};#o=e=>{for(let t in e){let s=this.getNamespacedKey(t),r=this.#a.get(s)?.callbackSet||new Set;if(r.add(e[t]),r.size>1)continue;let a=(e,t)=>{if(t!==this.area||!e[s])return;let r=this.#a.get(s);if(!r)throw Error(`Storage comms does not exist for nsKey: ${s}`);Promise.all([this.parseValue(e[s].newValue),this.parseValue(e[s].oldValue)]).then(([e,s])=>{for(let a of r.callbackSet)a({newValue:e,oldValue:s},t)})};this.#e.onChanged.addListener(a),this.#a.set(s,{callbackSet:r,listener:a})}};unwatch=e=>{let t=this.isWatchSupported();return t&&this.#l(e),t};#l(e){for(let t in e){let s=this.getNamespacedKey(t),r=e[t],a=this.#a.get(s);a&&(a.callbackSet.delete(r),0===a.callbackSet.size&&(this.#a.delete(s),this.#e.onChanged.removeListener(a.listener)))}}unwatchAll=()=>this.#c();#c(){this.#a.forEach(({listener:e})=>this.#e.onChanged.removeListener(e)),this.#a.clear()}async getItem(e){return this.get(e)}async getItems(e){return await this.getMany(e)}async setItem(e,t){await this.set(e,t)}async setItems(e){await await this.setMany(e)}async removeItem(e){return this.remove(e)}async removeItems(e){return await this.removeMany(e)}},l=class extends o{get=async e=>{let t=this.getNamespacedKey(e),s=await this.rawGet(t);return this.parseValue(s)};getMany=async e=>{let t=e.map(this.getNamespacedKey),s=await this.rawGetMany(t),r=await Promise.all(Object.values(s).map(this.parseValue));return Object.keys(s).reduce((e,t,s)=>(e[this.getUnnamespacedKey(t)]=r[s],e),{})};set=async(e,t)=>{let s=this.getNamespacedKey(e),r=this.serde.serializer(t);return this.rawSet(s,r)};setMany=async e=>{let t=Object.entries(e).reduce((e,[t,s])=>(e[this.getNamespacedKey(t)]=this.serde.serializer(s),e),{});return await this.rawSetMany(t)};remove=async e=>{let t=this.getNamespacedKey(e);return this.rawRemove(t)};removeMany=async e=>{let t=e.map(this.getNamespacedKey);return await this.rawRemoveMany(t)};setNamespace=e=>{this.keyNamespace=e};parseValue=async e=>{try{if(void 0!==e)return this.serde.deserializer(e)}catch(e){console.error(e)}}}},{pify:"2mL3q","@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],"2mL3q":[function(e,t,s){var r=e("@parcel/transformer-js/src/esmodule-helpers.js");r.defineInteropFlag(s),r.export(s,"default",()=>n);let a=(e,t,s,r)=>function(...a){let i=t.promiseModule;return new i((i,n)=>{t.multiArgs?a.push((...e)=>{t.errorFirst?e[0]?n(e):(e.shift(),i(e)):i(e)}):t.errorFirst?a.push((e,t)=>{e?n(e):i(t)}):a.push(i),Reflect.apply(e,this===s?r:this,a)})},i=new WeakMap;function n(e,t){t={exclude:[/.+(?:Sync|Stream)$/],errorFirst:!0,promiseModule:Promise,...t};let s=typeof e;if(!(null!==e&&("object"===s||"function"===s)))throw TypeError(`Expected \`input\` to be a \`Function\` or \`Object\`, got \`${null===e?"null":s}\``);let r=(e,s)=>{let r=i.get(e);if(r||(r={},i.set(e,r)),s in r)return r[s];let a=e=>"string"==typeof e||"symbol"==typeof s?s===e:e.test(s),n=Reflect.getOwnPropertyDescriptor(e,s),o=void 0===n||n.writable||n.configurable,l=t.include?t.include.some(e=>a(e)):!t.exclude.some(e=>a(e)),c=l&&o;return r[s]=c,c},n=new WeakMap,o=new Proxy(e,{apply(e,s,r){let i=n.get(e);if(i)return Reflect.apply(i,s,r);let l=t.excludeMain?e:a(e,t,o,e);return n.set(e,l),Reflect.apply(l,s,r)},get(e,s){let i=e[s];if(!r(e,s)||i===Function.prototype[s])return i;let l=n.get(i);if(l)return l;if("function"==typeof i){let s=a(i,t,o,e);return n.set(i,s),s}return i}});return o}},{"@parcel/transformer-js/src/esmodule-helpers.js":"f6DG4"}],f6DG4:[function(e,t,s){s.interopDefault=function(e){return e&&e.__esModule?e:{default:e}},s.defineInteropFlag=function(e){Object.defineProperty(e,"__esModule",{value:!0})},s.exportAll=function(e,t){return Object.keys(e).forEach(function(s){"default"===s||"__esModule"===s||t.hasOwnProperty(s)||Object.defineProperty(t,s,{enumerable:!0,get:function(){return e[s]}})}),t},s.export=function(e,t,s){Object.defineProperty(e,t,{enumerable:!0,get:s})}},{}]},["kgW6q"],"kgW6q","parcelRequire1e2a"),globalThis.define=t;